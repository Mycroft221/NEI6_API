<!DOCTYPE html>
<html>
<meta name="viewport" content="user-scalable=no, initial-scale=1, width=device-width, height=device-height, viewport-fit=cover">

<style>
body{
    padding-top: constant(safe-area-inset-top);
    padding-top: env(safe-area-inset-top);
}
input[type="radio"] {
    display: none;
}
input[type="checkbox"] {
    display: none;
}
input[type="number"] {
    margin: 4px 5px;
    margin-bottom: 18px;
    width: 128px;
    height: 15px;
}
input[type="button"] {
  float: left;
  padding: 8px 20px;
  background-color: rgb(0, 255, 0);
  border-radius: 10px;
  margin:5px;
}

label {
  float: none;
  padding: 8px 20px;
  background-color: rgb(218, 230, 255);
  border: thin solid rgb(0, 4, 255);
  border-radius: 10px;
  margin:3px;
  margin-top: 6px;
  margin-bottom:2px;
  display: inline-block;
}

input[type="radio"]:checked + label {
    background-color: rgb(0, 4, 255);
    cursor: default;
    color: #E6E6E6;
}

input[type="checkbox"]:checked + label {
    background-color: rgb(0, 4, 255);
    cursor: default;
    color: #E6E6E6;
}

p {
    font:bold;
    font-size: 110%;
    text-indent: 10px;
    margin-bottom: 0px;
    margin-top: 8px;
}
h2 {
    text-indent: 10px;
}
</style>
<script>
function httpGet(theUrl){
    // alert(theUrl);
    // alert("httpGet called");
    var xmlHttp = new XMLHttpRequest();
    // alert("var created");
    xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
    // alert("opened");
    xmlHttp.send( null );
    // alert("request sent");
    // alert(xmlHttp.responseText);
    return xmlHttp.responseText;
}
function handlePrediction(prediction) {
    const pred = + prediction[1];
    const ident = + prediction.slice(3, -1);
    console.log(pred, ident);
    alert("identifier: " + ident)
    if (pred == 1) {
        window.location = 'true.html';
    } else {
        window.location = 'false.html';
    }
}
function showTransferBlood() {
    if (document.getElementById('transfer').checked) {
        document.getElementById('transfer_blood').style.display='';
    } else {
        document.getElementById('transfer_blood').style.display='none';
    }
}
function showEtco2() {
    if (document.getElementById('etco2yes').checked) {
        document.getElementById('etco2_box').style.display='';
    } else {
        document.getElementById('etco2_box').style.display='none';
    }
}
function showBaseDeficit() {
    if (document.getElementById('baseyes').checked) {
        document.getElementById('base_deficit').style.display='';
    } else {
        document.getElementById('base_deficit').style.display='none';
    }
}
function showHelmetUse() {
    if (document.getElementById('ab').checked || document.getElementById('ac').checked) { // bike or motorcycle
        document.getElementById('helmet').style.display='';
    } else {
        document.getElementById('helmet').style.display='none';
    }
}
function buildRequestString() {
    return 'https://nei6.ddns.net:8443/predict?site=' + 
    document.querySelector('input[name=site]:checked').value +
    '&values=' + 
    (+ a.checked) + ',' + ((b.value - 46.58) / 56.92) + ',' + (+ c.checked) + 
    ',' + (+ d.checked) + ',' + e.value / 285 + ',' + f.value / 224 + ',' + 
    (g.value - 3) / 12 + ',' + (+ h.checked) + ',' + (+ i.checked)
    //   (+ j.checked) // + ',' + (+ k.checked)
    // gender
    + ',' + (+ male.checked) 
    + ',' + (age.value - 16) / 74 
    // temp not entered boolean
    // + ',' + + (b.value == '') + ',' + + (e.value == '') 
    // + ',' + + (f.value == '') + ',' + + (g.value = '')
    // (+ !(ad.checked || ae.checked || af.checked || ag.checked ||
    // ah.checked))
    // Race
    + ',' + (+ white.checked) + ',' + (+ hispanic.checked)
    + ',' + (+ asian.checked) + ',' + (+ black.checked)
    + ',' + (+ pacific_islander.checked) + ',' + (+ indian.checked)
    //   + ',' + (+ s.checked) + ',' + (+  t.checked) + ',' + (+ u.checked)
    // moi
    + ',' + (+ v.checked)+ ',' + (+ w.checked) +
    ',' + (+ x.checked) + ',' + (+ y.checked) + ',' + (+ z.checked) + 
    ',' + (+ aa.checked) + ',' + (+ ab.checked) + ',' + (+ ac.checked)
    // intentionality
    //   + ',' + (+ ad.checked) + ',' + (+ ae.checked) + ',' + (+ af.checked) 
    //   + ',' + (+ ag.checked) + ',' + (+ ah.checked) 
    + ',' + (+ (au.value < 15)) 
    + ',' + (+ (au.value >= 15 && au.value < 30)) + ',' + (+ (au.value >= 30)) 
    // transport mode 
    + ',' + (+ al.checked) 
    + ',' + (+ am.checked) + ',' + (+ ao.checked) 
    //   + ',' + (+ ap.checked) 
    //   + ',' + (+ aq.checked) + ',' + (+ ar.checked) + ',' + (+ as.checked) 
    //   + ',' + (+ at.checked) 
    // ETA
    + ',' + (au.value + 0)
    // legal intervention
    // + ',' + (+ av.checked) 
    + ',' + (+ aw.checked)
    + ',' + (+ ax.checked) + ',' + (+ ay.checked) + ',' + (+ az.checked)
    + ',' + (+ ba.checked) // + ',' + (bb.value + 0) 
    + ',' + (+ bc.checked) + 
    ',' + (+ bd.checked) + ',' + (etco2.value + 0)
    // base deficit
    + ',' + (bf.value + 0)
    // Head/Neck
    + ',' + (+ bg.checked) + ',' + (+ bh.checked) + ',' + (+ bi.checked) 
    + ',' + (+ bj.checked) + ',' + (+ bk.checked)
    // focal neurologic deficit
    + ',' + (+ bl.checked) 
    // Abdomen, other injuries
    + ',' + (+ bm.checked) + ',' + (+ bn.checked) + ',' + (+ bo.checked) 
    + ',' + (+ bp.checked) + ',' + (+ bq.checked) + ',' + (+ br.checked) 
    + ',' + (+ bs.checked) + ',' + (+ bt.checked) + ',' + (+ bu.checked) 
    + ',' + (+ bv.checked) 
    // fastna and fastpna
    + ',' + (+ bcna.checked) + ',' + (+ bdna.checked)
    + ',' + (+ transfer.checked) + ',' + (+ blood_transfer.checked) 
    + ',' + (+ or.checked) + ',' + (+ !etco2yes.checked) 
    + ',' + (+ !baseyes.checked) 
    + ',' + (+ female.checked) + ',' + (+ nonbinary.checked)
    + ',' + (+ india.checked) + ',' + (+ arab.checked)
}
</script>
<body>

<h2>Trauma Intervention Prediction</h2>
<!-- <p>The <strong>input type="radio"</strong> defines a radio button:</p> -->

<!-- <p>Please select all responses that apply in dark blue.</p>
<br> -->

<form>
    <p>Site</p>
    <input type="radio" id="froedtert" value="froedtert" name="site">
    <label for="froedtert">Froedtert</label>
    <input type="radio" id="north_memorial" value="north_memorial" name="site">
    <label for="north_memorial">North Memorial</label>
    <input type="radio" id="ksmc" value="ksmc" name="site">
    <label for="ksmc">KSMC</label>
    <input type="radio" id="ohio_health" value="ohio_health" name="site">
    <label for="ohio_health">Ohio Health</label>

    <input type="radio" id="njms" value="njms" name="site">
    <label for="njms">NJMS</label>
    <input type="radio" id="uk_healthcare" value="uk_healthcare" name="site">
    <label for="uk_healthcare">UK Healthcare</label>
    <input type="radio" id="uthealth" value="uthealth" name="site">
    <label for="uthealth">UTHealth</label>
    <input type="radio" id="houston" value="houston" name="site">
    <label for="houston">Houston</label>
    <br><br>

  <p>Level of Care</p>
  <input type="radio" id="a" name="0">
  <label for="a">ALS</label>
  <input type="radio" id="an" name="0" checked>
  <label for="an">BLS</label>
  <br><br>

  <p>Patient Type</p>
  <input type="radio" id="transfer" name="transfer_radio" onclick="showTransferBlood()">
  <label for="transfer">Transfer</label>
  <input type="radio" id="transfern" name="transfer_radio" onclick="showTransferBlood()" checked>
  <label for="transfern">Scene</label>
  <br><br>

  <div id="transfer_blood" style="display: none;">
    <p>Received Blood During Transfer</p>
    <input type="radio" id="blood_transfer" name="blood">
    <label for="blood_transfer">Yes</label>
    <input type="radio" id="blood_transfern" name="blood" checked>
    <label for="blood_transfern">No</label>
    <br><br>
  </div>

  <p>Transfer Method</p>
  <input type="checkbox" id="al">
  <label for="al">Ground</label>
  <input type="checkbox" id="am">
  <label for="am">Helicopter</label>
  <input type="checkbox" id="ao">
  <label for="ao">Other</label>
  <br><br>

  <p>Estimated Time to Arrival (min)</p>
  <input type="number" id="au" step="any">
  <br>
  
  <h3>Please record most aberrant vitals below:</h3>


  <p>Systolic Blood Pressure</p>
  <input type="number" id="e" step="1">
  <br>

  <p>Pulse</p>
  <input type="number" id="f" step="1">
  <br>

  <p>GCS Score</p>
  <input type="number" id="g" step="1">
  <br>

  <p>Temperature (F)</p>
  <input type="number" id="b" step="any">
  <br>

  <p>Age</p>
  <input type="number" id="age" step="1">
  <br>

  <p>Gender</p>
  <input type="radio" id="male" name="10">
  <label for="male">Male</label>
  <input type="radio" id="female" name="10">
  <label for="female">Female</label>
  <input type="radio" id="nonbinary" name="10">
  <label for="nonbinary">Nonbinary</label>
  <br><br>

  <p>Race</p>
  <input type="checkbox" id="white">
  <label for="white">White</label>
  <input type="checkbox" id="hispanic">
  <label for="hispanic">Hispanic or Latino</label>
  <input type="checkbox" id="asian">
  <label for="asian">Asian</label>
  <input type="checkbox" id="black">
  <label for="black">Black or African American</label>
  <input type="checkbox" id="pacific_islander">
  <label for="pacific_islander">Native Hawaiian or Other Pacific Islander</label>
  <input type="checkbox" id="indian">
  <label for="indian">Amercan Indian or Alaska Native</label>
  <input type="checkbox" id="india">
  <label for="india">Indian</label>
  <input type="checkbox" id="arab">
  <label for="arab">Arab</label>
  <br><br>

  <p>Bariatric</p>
  <input type="radio" id="c" name="1">
  <label for="c">Yes</label>
  <input type="radio" id="cn" name="1" checked>
  <label for="cn">No</label>
  <br><br>

  <p>Mechanism of Injury</p>
  <input type="checkbox" id="w">
  <label for="w">Stab</label>
  <input type="checkbox" id="x">
  <label for="x">Gunshot</label>
  <input type="checkbox" id="y">
  <label for="y">Fall</label>
  <input type="checkbox" id="z">
  <label for="z">Motor Vehicle</label>
  <input type="checkbox" id="aa">
  <label for="aa">Motorcycle</label>
  <input type="checkbox" id="ab" onclick="showHelmetUse()">
  <label for="ab">Bicycle</label>
  <input type="checkbox" id="ac" onclick="showHelmetUse()">
  <label for="ac">Pedestrian Struck</label>
  <input type="checkbox" id="v">
  <label for="v">Other</label>
  <br><br>

  <div id="helmet" style="display: none;">
    <p>Helmet Use</p>
    <input type="radio" id="d" name="2">
    <label for="d">Yes</label>
    <input type="radio" id="dn" name="2" checked>
    <label for="dn">No</label>
    <br><br>
  </div>

  <p>Open Fracture</p>
  <input type="radio" id="h" name="3">
  <label for="h">Yes</label>
  <input type="radio" id="hn" name="3" checked>
  <label for="hn">No</label>
  <br><br>

  <p>Central Gunshot Wound</p>
  <input type="radio" id="i" name="4">
  <label for="i">Yes</label>
  <input type="radio" id="in" name="4" checked>
  <label for="in">No</label>
  <br><br>

  <p>Field Assisted Ventilation</p>
  <input type="checkbox" id="aw">
  <label for="aw">Intubated</label>
  <!-- Changed from king airway -->
  <input type="checkbox" id="ax">
  <label for="ax">Supraglottic</label>
  <!--
  <input type="checkbox" id="ay">
  <label for="ay">LMA</label>
  -->
  <input type="checkbox" id="az">
  <label for="az">BVM</label>
  <br><br>

  <p>Field Receiving Blood</p>
  <input type="radio" id="ba" name="15">
  <label for="ba">Yes</label>
  <input type="radio" id="ban" name="15" checked>
  <label for="ban">No</label>
  <br><br>

  <p>Prehospital FAST</p>
  <input type="radio" id="bc" name="16">
  <label for="bc">Positive</label>
  <input type="radio" id="bcn" name="16">
  <label for="bcn">Negative</label>
  <input type="radio" id="bcna" name="16" checked>
  <label for="bcna">N/A</label>
  <br><br>

  <p>Prehospital FAST Pericardial Window</p>
  <input type="radio" id="bd" name="17">
  <label for="bd">Positive</label>
  <input type="radio" id="bdn" name="17">
  <label for="bdn">Negative</label>
  <input type="radio" id="bdna" name="17" checked>
  <label for="bdna">N/A</label>
  <br><br>

  <p>End Tidal CO2 Reading Available</p>
  <input type="radio" id="etco2yes" name="etco2radio" onclick="showEtco2()">
  <label for="etco2yes">Yes</label>
  <input type="radio" id="etco2no" name="etco2radio" onclick="showEtco2()" checked>
  <label for="etco2no">No</label>
  <br><br>

  <div id="etco2_box" style="display: none;">
    <p>End Tidal CO2 (mmHg)</p>
    <input type="number" id="etco2" step="any">
    <br>
  </div>

  <p>Base Deficit Reading Available</p>
  <input type="radio" id="baseyes" name="baseradio" onclick="showBaseDeficit()">
  <label for="baseyes">Yes</label>
  <input type="radio" id="baseno" name="baseradio" onclick="showBaseDeficit()" checked>
  <label for="baseno">No</label>
  <br><br>

  <div id="base_deficit" style="display: none;">
    <p>Base Deficit (Meq/L)</p>
    <input type="number" id="bf" step="any">
    <br>
  </div>

  <p>Head/Neck</p>
  <input type="checkbox" id="bg">
  <label for="bg">Depressed Skull Fracture</label>
  <input type="checkbox" id="bh">
  <label for="bh">Penetrating Injury</label>
  <input type="checkbox" id="bi">
  <label for="bi">Large Laceration</label>
  <input type="checkbox" id="bj">
  <label for="bj">Difficulty Breathing/Speaking/Swallowing</label>
  <input type="checkbox" id="bk">
  <label for="bk">Pulsatile Bleeding</label>
  <br><br>

  <p>Focal Neurologic Deficit</p>
  <input type="radio" id="bl" name="18">
  <label for="bl">Yes</label>
  <input type="radio" id="bln" name="18" checked>
  <label for="bln">No</label>
  <br><br>

  <p>Abdomen</p>
  <input type="checkbox" id="bm">
  <label for="bm">Penetrating Injury</label>
  <input type="checkbox" id="bn">
  <label for="bn">Unstable Pelvis</label>
  <input type="checkbox" id="bo">
  <label for="bo">Evisceration</label>
  <br><br>

  <p>Chest</p>
  <input type="checkbox" id="bp">
  <label for="bp">Flail Chest</label>
  <input type="checkbox" id="bq">
  <label for="bq">Open "Sucking" Wound</label>
  <br><br>

  <p>Extremities</p>
  <input type="checkbox" id="br">
  <label for="br">Open Fracture</label>
  <input type="checkbox" id="bs">
  <label for="bs">Tourniquet</label>
  <input type="checkbox" id="bt">
  <label for="bt">Pulsatile Bleeding</label>
  <input type="checkbox" id="bu">
  <label for="bu">Pulseless Extremity</label>
  <input type="checkbox" id="bv">
  <label for="bv">Partial or Complete Amputation</label>
  <br><br>

  <p>Do you think the patient should go directly to the operating room?</p>
  <input type="radio" id="or" name="19">
  <label for="or">Yes</label>
  <input type="radio" id="orn" name="19" checked>
  <label for="orn">No</label>
  <br><br>

  <br>

  <input type="button" value="Submit" onclick="
    handlePrediction(
      httpGet(
        buildRequestString()
      )
    )">
  <br><br><br>
</form> 

</body>
</html>
